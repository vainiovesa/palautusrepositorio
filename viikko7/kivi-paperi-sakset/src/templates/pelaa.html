{% extends "base.html" %}

{% block title %}Pelaa - Kivi-Paperi-Sakset{% endblock %}

{% block content %}
<div class="game-area">
    <h2>
        {% if game_type == 'kaksinpeli' %}
            ğŸ‘¥ Kaksinpeli
        {% elif game_type == 'yksinpeli' %}
            ğŸ¤– TekoÃ¤ly (helppo)
        {% else %}
            ğŸ§  TekoÃ¤ly (haastava)
        {% endif %}
    </h2>
    
    <div class="scoreboard">
        <h3>Tilanne (EnsimmÃ¤inen 5 voittoon!)</h3>
        <div class="score-display">
            <div class="score-item">
                <span class="label">Pelaaja 1:</span>
                <span class="value">{{ tuomari.ekan_pisteet }}</span>
            </div>
            <div class="score-item">
                <span class="label">
                    {% if game_type == 'kaksinpeli' %}
                        Pelaaja 2:
                    {% else %}
                        Tietokone:
                    {% endif %}
                </span>
                <span class="value">{{ tuomari.tokan_pisteet }}</span>
            </div>
            <div class="score-item">
                <span class="label">Tasapelit:</span>
                <span class="value">{{ tuomari.tasapelit }}</span>
            </div>
        </div>
    </div>
    
    {% if peli_paattynyt %}
    <div class="game-over">
        <h3>ğŸ‰ Peli pÃ¤Ã¤ttyi!</h3>
        <p class="winner-announcement">
            {% if voittaja == 1 %}
                ğŸ† Pelaaja 1 voitti pelin!
            {% elif voittaja == 2 %}
                {% if game_type == 'kaksinpeli' %}
                    ğŸ† Pelaaja 2 voitti pelin!
                {% else %}
                    ğŸ¤– Tietokone voitti pelin!
                {% endif %}
            {% endif %}
        </p>
        <div class="game-over-actions">
            <a href="{{ url_for('valitse_peli', game_type=game_type) }}" class="btn btn-primary">Pelaa uudestaan</a>
            <a href="{{ url_for('index') }}" class="btn btn-secondary">Palaa etusivulle</a>
        </div>
    </div>
    {% endif %}
    
    {% if not peli_paattynyt %}
    <div class="game-form">
        {% if game_type == 'kaksinpeli' %}
            <div class="two-player-instructions">
                <p>ğŸ“‹ <strong>Ohjeet:</strong> Pelaaja 1 valitsee siirtonsa ja antaa vuoron pelaaja 2:lle. Pelaaja 2 valitsee siirtonsa paljastamatta sitÃ¤ pelaaja 1:lle.</p>
            </div>
        {% endif %}
        
        <form method="POST" action="{{ url_for('pelaa') }}" id="gameForm">
            <div class="player-section" id="player1-section">
                <h4>Pelaaja 1 - valitse siirtosi:</h4>
                <div class="move-buttons">
                    {% if game_type == 'kaksinpeli' %}
                        <label class="move-radio">
                            <input type="radio" name="pelaaja1_siirto" value="k" required onchange="showPlayer2()">
                            <span class="move-label">ğŸª¨<br>Kivi</span>
                        </label>
                        <label class="move-radio">
                            <input type="radio" name="pelaaja1_siirto" value="p" required onchange="showPlayer2()">
                            <span class="move-label">ğŸ“„<br>Paperi</span>
                        </label>
                        <label class="move-radio">
                            <input type="radio" name="pelaaja1_siirto" value="s" required onchange="showPlayer2()">
                            <span class="move-label">âœ‚ï¸<br>Sakset</span>
                        </label>
                    {% else %}
                        <button type="submit" name="pelaaja1_siirto" value="k" class="move-btn">
                            ğŸª¨<br>Kivi
                        </button>
                        <button type="submit" name="pelaaja1_siirto" value="p" class="move-btn">
                            ğŸ“„<br>Paperi
                        </button>
                        <button type="submit" name="pelaaja1_siirto" value="s" class="move-btn">
                            âœ‚ï¸<br>Sakset
                        </button>
                    {% endif %}
                </div>
            </div>
            
            {% if game_type == 'kaksinpeli' %}
            <div class="player-section" id="player2-section" style="display: none;">
                <h4>Pelaaja 2 - valitse siirtosi:</h4>
                <p class="warning-text">âš ï¸ Varmista, ettÃ¤ pelaaja 1 ei nÃ¤e valintaasi!</p>
                <div class="move-buttons">
                    <label class="move-radio">
                        <input type="radio" name="pelaaja2_siirto" value="k" required>
                        <span class="move-label">ğŸª¨<br>Kivi</span>
                    </label>
                    <label class="move-radio">
                        <input type="radio" name="pelaaja2_siirto" value="p" required>
                        <span class="move-label">ğŸ“„<br>Paperi</span>
                    </label>
                    <label class="move-radio">
                        <input type="radio" name="pelaaja2_siirto" value="s" required>
                        <span class="move-label">âœ‚ï¸<br>Sakset</span>
                    </label>
                </div>
                <div class="submit-section">
                    <button type="submit" class="btn btn-primary">Pelaa kierros</button>
                </div>
            </div>
            {% endif %}
        </form>
    </div>
    {% endif %}
    
    <script>
        function showPlayer2() {
            const player1Section = document.getElementById('player1-section');
            const player2Section = document.getElementById('player2-section');
            
            // Hide player 1 section and show player 2 section
            player1Section.style.display = 'none';
            player2Section.style.display = 'block';
            
            // Scroll to player 2 section
            player2Section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    </script>
    
    {% if historia and not peli_paattynyt %}
    <div class="history">
        <h3>Pelihistoria (viimeisimmÃ¤t 10 kierrosta)</h3>
        <table>
            <thead>
                <tr>
                    <th>Kierros</th>
                    <th>Pelaaja 1</th>
                    <th>
                        {% if game_type == 'kaksinpeli' %}
                            Pelaaja 2
                        {% else %}
                            Tietokone
                        {% endif %}
                    </th>
                </tr>
            </thead>
            <tbody>
                {% for i in range(historia|length - 1, [historia|length - 11, -1]|max, -1) %}
                <tr>
                    <td>{{ i + 1 }}</td>
                    <td>
                        {% if historia[i].pelaaja1 == 'k' %}ğŸª¨ Kivi
                        {% elif historia[i].pelaaja1 == 'p' %}ğŸ“„ Paperi
                        {% else %}âœ‚ï¸ Sakset{% endif %}
                    </td>
                    <td>
                        {% if historia[i].pelaaja2 == 'k' %}ğŸª¨ Kivi
                        {% elif historia[i].pelaaja2 == 'p' %}ğŸ“„ Paperi
                        {% else %}âœ‚ï¸ Sakset{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
    
    {% if not peli_paattynyt %}
    <div class="actions">
        <a href="{{ url_for('lopeta') }}" class="btn btn-secondary">Lopeta peli</a>
    </div>
    {% endif %}
</div>
{% endblock %}
